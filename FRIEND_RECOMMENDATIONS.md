# 朋友推荐功能 (Friend Recommendations)

## 功能概述

朋友推荐功能帮助用户发现具有相似音乐品味的其他用户，从而增强平台的社交互动和用户留存率。

## 功能特性

### 推荐逻辑
1. **基于共同音乐偏好**: 分析用户最近听过的歌曲心情，找到有相似偏好的用户
2. **朋友的朋友**: 推荐被用户关注的人所关注的用户
3. **智能排序**: 根据共同兴趣数量和互动频率进行排序

### 用户界面
- 现代化的卡片式布局
- 显示用户头像（基于用户名首字母）
- 推荐理由说明
- 一键关注/取消关注功能
- 响应式设计，支持移动端

## 技术实现

### 后端 API

#### 端点: `GET /api/users/recommendations/friends`

**功能**: 获取朋友推荐列表

**请求头**:
```
Authorization: Bearer <jwt_token>
```

**响应格式**:
```json
{
  "recommendations": [
    {
      "user": {
        "id": "user_id",
        "username": "username",
        "bio": "user_bio"
      },
      "rationale": "推荐理由",
      "score": 5
    }
  ],
  "total": 3
}
```

**推荐算法**:
1. 获取当前用户最近20首歌曲的心情偏好
2. 排除已关注的用户和当前用户
3. 基于MongoDB聚合管道查找有相似心情偏好的用户
4. 计算"朋友的朋友"关系
5. 合并结果并按分数排序

### 前端组件

#### FriendRecommendations 组件

**功能**:
- 获取并显示推荐用户列表
- 处理关注/取消关注操作
- 实时更新关注状态
- 错误处理和加载状态

**Props**:
- `onFollowChange`: 关注状态改变时的回调函数

**状态管理**:
- `recommendations`: 推荐用户列表
- `loading`: 加载状态
- `error`: 错误信息
- `followStatus`: 关注状态映射

## 数据库设计

### 用户模型增强
- `followers`: 关注者列表
- `following`: 关注列表
- `preferences`: 用户偏好设置

### 歌曲日志模型
- `mood`: 歌曲心情标签
- `timestamp`: 记录时间
- `user`: 用户引用

## 安装和运行

### 后端设置
1. 确保MongoDB已启动
2. 安装依赖: `pip install -r requirements.txt`
3. 启动服务器: `python app.py`

### 前端设置
1. 安装依赖: `npm install`
2. 启动开发服务器: `npm start`

### 测试
运行测试脚本验证功能:
```bash
cd backend
python test_recommendations.py
```

## 使用流程

1. 用户登录后，在侧边栏选择"Friend Recommendations"
2. 系统显示推荐用户列表
3. 用户可以查看推荐理由并点击"关注"
4. 关注后按钮变为"已关注"状态
5. 已关注的用户不会再次出现在推荐列表中

## 性能优化

- 使用MongoDB聚合管道进行高效查询
- 限制推荐结果数量（最多10个）
- 缓存用户关注状态
- 响应式设计优化移动端体验

## 未来扩展

- 基于艺术家偏好的推荐
- 时间活跃度分析
- 地理位置推荐
- 机器学习优化推荐算法
- 推荐理由的个性化展示

## 错误处理

- API连接错误处理
- 用户认证失败处理
- 数据库查询异常处理
- 前端网络错误处理
- 友好的错误提示信息 